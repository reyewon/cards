var se=Object.defineProperty;var ne=(e,s,t)=>s in e?se(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var c=(e,s,t)=>ne(e,typeof s!="symbol"?s+"":s,t);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();function re(e){if(!e)return;const s=e.getContext("2d"),t=[],r=18;function i(){e.width=window.innerWidth,e.height=window.innerHeight}function a(l,y){return l+Math.random()*(y-l)}function u(){return{x:a(0,e.width),y:a(0,e.height),r:a(2,5),dx:a(-.3,.3),dy:a(-.4,-.1),opacity:a(.3,.7),color:Math.random()>.5?"#ff0080":"#00e5ff",pulse:a(0,Math.PI*2),pulseSpeed:a(.005,.02)}}i();for(let l=0;l<r;l++)t.push(u());window.addEventListener("resize",i,{passive:!0});function p(){s.clearRect(0,0,e.width,e.height),t.forEach(l=>{l.pulse+=l.pulseSpeed;const y=.6+.4*Math.sin(l.pulse),_=l.opacity*y;s.beginPath(),s.arc(l.x,l.y,l.r,0,Math.PI*2),s.fillStyle=l.color,s.globalAlpha=_,s.fill(),s.globalAlpha=1,l.x+=l.dx,l.y+=l.dy,l.y<-10&&(l.y=e.height+10,l.x=a(0,e.width)),l.x<-10&&(l.x=e.width+10),l.x>e.width+10&&(l.x=-10)}),requestAnimationFrame(p)}requestAnimationFrame(p)}(!globalThis.EventTarget||!globalThis.Event)&&console.error(`
  PartySocket requires a global 'EventTarget' class to be available!
  You can polyfill this global by adding this to your code before any partysocket imports: 
  
  \`\`\`
  import 'partysocket/event-target-polyfill';
  \`\`\`
  Please file an issue at https://github.com/partykit/partykit if you're still having trouble.
`);var Y=class extends Event{constructor(s,t){super("error",t);c(this,"message");c(this,"error");this.message=s.message,this.error=s}},B=class extends Event{constructor(s=1e3,t="",r){super("close",r);c(this,"code");c(this,"reason");c(this,"wasClean",!0);this.code=s,this.reason=t}};const S={Event,ErrorEvent:Y,CloseEvent:B};function oe(e,s){if(!e)throw new Error(s)}function ie(e){return new e.constructor(e.type,e)}function ae(e){return"data"in e?new MessageEvent(e.type,e):"code"in e||"reason"in e?new B(e.code||1999,e.reason||"unknown reason",e):"error"in e?new Y(e.error,e):new Event(e.type,e)}var j;const le=typeof process<"u"&&typeof((j=process.versions)==null?void 0:j.node)<"u"&&typeof document>"u",ce=typeof navigator<"u"&&navigator.product==="ReactNative",P=le||ce?ae:ie,b={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:Number.POSITIVE_INFINITY,maxEnqueuedMessages:Number.POSITIVE_INFINITY};let Q=!1;var ue=class x extends EventTarget{constructor(t,r,i={}){super();c(this,"_ws");c(this,"_retryCount",-1);c(this,"_uptimeTimeout");c(this,"_connectTimeout");c(this,"_shouldReconnect",!0);c(this,"_connectLock",!1);c(this,"_binaryType","blob");c(this,"_closeCalled",!1);c(this,"_messageQueue",[]);c(this,"_debugLogger",console.log.bind(console));c(this,"_url");c(this,"_protocols");c(this,"_options");c(this,"onclose",null);c(this,"onerror",null);c(this,"onmessage",null);c(this,"onopen",null);c(this,"_handleOpen",t=>{this._debug("open event");const{minUptime:r=b.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),r),oe(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(i=>{var a;(a=this._ws)==null||a.send(i)}),this._messageQueue=[],this.onopen&&this.onopen(t),this.dispatchEvent(P(t))});c(this,"_handleMessage",t=>{this._debug("message event"),this.onmessage&&this.onmessage(t),this.dispatchEvent(P(t))});c(this,"_handleError",t=>{this._debug("error event",t.message),this._disconnect(void 0,t.message==="TIMEOUT"?"timeout":void 0),this.onerror&&this.onerror(t),this._debug("exec error listeners"),this.dispatchEvent(P(t)),this._connect()});c(this,"_handleClose",t=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(t),this.dispatchEvent(P(t))});this._url=t,this._protocols=r,this._options=i,this._options.startClosed&&(this._shouldReconnect=!1),this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return x.CONNECTING}get OPEN(){return x.OPEN}get CLOSING(){return x.CLOSING}get CLOSED(){return x.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((t,r)=>(typeof r=="string"?t+=r.length:r instanceof Blob?t+=r.size:t+=r.byteLength,t),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?x.CLOSED:x.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}close(t=1e3,r){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(t,r)}reconnect(t,r){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(t,r),this._connect())}send(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{const{maxEnqueuedMessages:r=b.maxEnqueuedMessages}=this._options;this._messageQueue.length<r&&(this._debug("enqueue",t),this._messageQueue.push(t))}}_debug(...t){this._options.debug&&this._debugLogger("RWS>",...t)}_getNextDelay(){const{reconnectionDelayGrowFactor:t=b.reconnectionDelayGrowFactor,minReconnectionDelay:r=b.minReconnectionDelay,maxReconnectionDelay:i=b.maxReconnectionDelay}=this._options;let a=0;return this._retryCount>0&&(a=r*t**(this._retryCount-1),a>i&&(a=i)),this._debug("next delay",a),a}_wait(){return new Promise(t=>{setTimeout(t,this._getNextDelay())})}_getNextProtocols(t){if(!t)return Promise.resolve(null);if(typeof t=="string"||Array.isArray(t))return Promise.resolve(t);if(typeof t=="function"){const r=t();if(!r)return Promise.resolve(null);if(typeof r=="string"||Array.isArray(r))return Promise.resolve(r);if(r.then)return r}throw Error("Invalid protocols")}_getNextUrl(t){if(typeof t=="string")return Promise.resolve(t);if(typeof t=="function"){const r=t();if(typeof r=="string")return Promise.resolve(r);if(r.then)return r}throw Error("Invalid URL")}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;const{maxRetries:t=b.maxRetries,connectionTimeout:r=b.connectionTimeout}=this._options;if(this._retryCount>=t){this._debug("max retries reached",this._retryCount,">=",t),this._connectLock=!1;return}this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([i,a])=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!Q&&(console.error(`â€¼ï¸ No WebSocket implementation available. You should define options.WebSocket. 

For example, if you're using node.js, run \`npm install ws\`, and then in your code:

import PartySocket from 'partysocket';
import WS from 'ws';

const partysocket = new PartySocket({
  host: "127.0.0.1:1999",
  room: "test-room",
  WebSocket: WS
});

`),Q=!0);const u=this._options.WebSocket||WebSocket;this._debug("connect",{url:i,protocols:a}),this._ws=a?new u(i,a):new u(i),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),r)}).catch(i=>{this._connectLock=!1,this._handleError(new S.ErrorEvent(Error(i.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new S.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(t=1e3,r){if(this._clearTimeouts(),!!this._ws){this._removeListeners();try{(this._ws.readyState===this.OPEN||this._ws.readyState===this.CONNECTING)&&this._ws.close(t,r),this._handleClose(new S.CloseEvent(t,r,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}};const de=e=>e[1]!==null&&e[1]!==void 0;function he(){if(crypto!=null&&crypto.randomUUID)return crypto.randomUUID();let e=Date.now(),s=(performance==null?void 0:performance.now)&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let r=Math.random()*16;return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(s+r)%16|0,s=Math.floor(s/16)),(t==="x"?r:r&3|8).toString(16)})}function V(e,s,t={}){const{host:r,path:i,protocol:a,room:u,party:p,basePath:l,prefix:y,query:_}=e;let h=r.replace(/^(http|https|ws|wss):\/\//,"");if(h.endsWith("/")&&(h=h.slice(0,-1)),i!=null&&i.startsWith("/"))throw new Error("path must not start with a slash");const D=p??"main",H=i?`/${i}`:"",W=a||(h.startsWith("localhost:")||h.startsWith("127.0.0.1:")||h.startsWith("192.168.")||h.startsWith("10.")||h.startsWith("172.")&&h.split(".")[1]>="16"&&h.split(".")[1]<="31"||h.startsWith("[::ffff:7f00:1]:")?s:`${s}s`),U=`${W}://${h}/${l||`${y||"parties"}/${D}/${u}`}${H}`,F=(te={})=>`${U}?${new URLSearchParams([...Object.entries(t),...Object.entries(te).filter(de)])}`,ee=typeof _=="function"?async()=>F(await _()):F(_);return{host:h,path:H,room:u,name:D,protocol:W,partyUrl:U,urlProvider:ee}}var me=class extends ue{constructor(s){var r,i;const t=A(s);super(t.urlProvider,t.protocols,t.socketOptions);c(this,"_pk");c(this,"_pkurl");c(this,"name");c(this,"room");c(this,"host");c(this,"path");c(this,"basePath");if(this.partySocketOptions=s,this.setWSProperties(t),!s.startClosed&&!this.room&&!this.basePath)throw this.close(),new Error("Either room or basePath must be provided to connect. Use startClosed: true to create a socket and set them via updateProperties before calling reconnect().");s.disableNameValidation||((r=s.party)!=null&&r.includes("/")&&console.warn(`PartySocket: party name "${s.party}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`),(i=s.room)!=null&&i.includes("/")&&console.warn(`PartySocket: room name "${s.room}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`))}updateProperties(s){const t=A({...this.partySocketOptions,...s,host:s.host??this.host,room:s.room??this.room,path:s.path??this.path,basePath:s.basePath??this.basePath});this._url=t.urlProvider,this._protocols=t.protocols,this._options=t.socketOptions,this.setWSProperties(t)}setWSProperties(s){const{_pk:t,_pkurl:r,name:i,room:a,host:u,path:p,basePath:l}=s;this._pk=t,this._pkurl=r,this.name=i,this.room=a,this.host=u,this.path=p,this.basePath=l}reconnect(s,t){if(!this.host)throw new Error("The host must be set before connecting, use `updateProperties` method to set it or pass it to the constructor.");if(!this.room&&!this.basePath)throw new Error("The room (or basePath) must be set before connecting, use `updateProperties` method to set it or pass it to the constructor.");super.reconnect(s,t)}get id(){return this._pk}get roomUrl(){return this._pkurl}static async fetch(s,t){const r=V(s,"http"),i=typeof r.urlProvider=="string"?r.urlProvider:await r.urlProvider();return(s.fetch??fetch)(i,t)}};function A(e){const{id:s,host:t,path:r,party:i,room:a,protocol:u,query:p,protocols:l,...y}=e,_=s||he(),h=V(e,"ws",{_pk:_});return{_pk:_,_pkurl:h.partyUrl,name:h.name,room:h.room,host:h.host,path:h.path,basePath:e.basePath,protocols:l,socketOptions:y,urlProvider:h.urlProvider}}const pe="kink-and-tell.reyewon.partykit.dev";class z{constructor(s,t){this.roomCode=s,this.playerName=t,this.socket=null,this.handlers={},this.isConnected=!1,this.isHost=!1}on(s,t){return this.handlers[s]=t,this}emit(s,t){const r=this.handlers[s];r&&r(t)}async connect(){return new Promise((s,t)=>{try{this.socket=new me({host:pe,room:this.roomCode.toLowerCase(),query:{name:this.playerName}}),this.socket.addEventListener("open",()=>{this.isConnected=!0,s()}),this.socket.addEventListener("message",r=>{try{const i=JSON.parse(r.data);this.emit(i.type,i.state||i)}catch{}}),this.socket.addEventListener("error",r=>{console.warn("PartyKit connection error:",r),t(r)}),this.socket.addEventListener("close",()=>{this.isConnected=!1}),setTimeout(()=>{this.isConnected||t(new Error("Connection timeout"))},8e3)}catch(r){t(r)}})}send(s){if(!(!this.socket||!this.isConnected))try{this.socket.send(JSON.stringify(s))}catch{}}disconnect(){this.socket&&(this.socket.close(),this.socket=null),this.isConnected=!1}}const f={};async function fe(){const e=["couple-questions","couple-forfeits","friends-questions","friends-forfeits","group-questions","group-forfeits"];await Promise.all(e.map(async s=>{const t=await fetch(`/data/${s}.json`);f[s.replace(/-/g,"_")]=await t.json()}))}const n={mode:null,players:[],intensity:"spicy",currentPlayerIndex:0,currentTargetIndex:null,usedQuestions:[],usedForfeits:[],isRemote:!1,isHost:!1,roomCode:null},O={SESSION:"knt_session_v2"};function v(){try{localStorage.setItem(O.SESSION,JSON.stringify({mode:n.mode,players:n.players,intensity:n.intensity,currentPlayerIndex:n.currentPlayerIndex,usedQuestions:n.usedQuestions,usedForfeits:n.usedForfeits}))}catch{}}function ye(){var e;try{const s=localStorage.getItem(O.SESSION);if(!s)return!1;const t=JSON.parse(s);return!t.mode||!((e=t.players)!=null&&e.length)?!1:(Object.assign(n,t),!0)}catch{return!1}}function ge(){try{localStorage.removeItem(O.SESSION)}catch{}}function G(e){const{intensity:s}=n;if(!e||typeof e!="object")return!0;const t=e.type||"neutral";return s==="tame"?t==="neutral":s==="spicy"?t==="neutral"||t==="D_asks_S"||t==="S_asks_D"||t==="target":!0}function J(e){return e[Math.floor(Math.random()*e.length)]}function I(){let e;if(n.mode==="couple"){const i=n.players[n.currentPlayerIndex].role,a=n.players[(n.currentPlayerIndex+1)%2].role;let u=["neutral"];i==="Dom"&&(a==="sub"||a==="switch")?u.push("D_asks_S"):(i==="sub"||i==="switch")&&a==="Dom"?u.push("S_asks_D"):i==="switch"&&a==="sub"?u.push("D_asks_S"):i==="sub"&&a==="switch"&&u.push("S_asks_D"),e=f.couple_questions.filter((p,l)=>!n.usedQuestions.includes(l)&&u.includes(p.type)),e.length||(e=f.couple_questions.filter((p,l)=>!n.usedQuestions.includes(l)&&p.type==="neutral")),e.length||(n.usedQuestions=[],e=f.couple_questions.filter(p=>u.includes(p.type)))}else if(n.mode==="group"){const i=f.group_questions;e=i.filter((a,u)=>!n.usedQuestions.includes(u)&&G(a)),e.length||(n.usedQuestions=[],e=i.filter(a=>G(a)))}else{const i=f.friends_questions;e=i.filter((a,u)=>!n.usedQuestions.includes(u)),e.length||(n.usedQuestions=[],e=[...i])}const s=J(e);if(!s)return{text:"No questions available. Reset and try again!",type:"neutral"};const r=(n.mode==="couple"?f.couple_questions:n.mode==="group"?f.group_questions:f.friends_questions).indexOf(s);return r>=0&&!n.usedQuestions.includes(r)&&n.usedQuestions.push(r),s}function _e(){const e=n.mode==="couple"?f.couple_forfeits:n.mode==="group"?f.group_forfeits:f.friends_forfeits;let s=e.filter((i,a)=>!n.usedForfeits.includes(a));s.length||(n.usedForfeits=[],s=[...e]);const t=J(s),r=e.indexOf(t);return r>=0&&n.usedForfeits.push(r),t}function T(e){const s=n.players[n.currentPlayerIndex];if(n.mode==="group"){const r=e??n.currentTargetIndex;return r!=null?`${s.name} asks ${n.players[r].name}:`:`${s.name} asks the group:`}const t=n.players[(n.currentPlayerIndex+1)%2];return`${s.name} asks ${t.name}:`}const o=e=>document.getElementById(e),N={welcome:o("screen-welcome"),join:o("screen-join"),setupTwo:o("screen-setup-two"),setupGroup:o("screen-setup-group"),roomLobby:o("screen-room-lobby"),guestLobby:o("screen-guest-lobby"),interstitial:o("screen-interstitial"),game:o("screen-game")};function m(e){Object.values(N).forEach(s=>s.classList.remove("active")),N[e].classList.add("active"),N[e].scrollTop=0}re(o("bgCanvas"));let d=null,w=null,L=60;function K(){clearInterval(w),w=null,L=60,o("timer-display").textContent="60",o("timer-display").classList.remove("warning"),o("btn-timer").textContent="Start Timer â±"}function we(){if(w){clearInterval(w),w=null,o("btn-timer").textContent="Start Timer â±";return}L=60,o("timer-display").textContent="60",o("timer-display").classList.remove("warning"),o("btn-timer").textContent="Stop â¹",w=setInterval(()=>{L--,o("timer-display").textContent=L,L<=10&&o("timer-display").classList.add("warning"),L<=0&&(clearInterval(w),w=null,o("timer-display").textContent="â°",o("btn-timer").textContent="Start Timer â±")},1e3)}function E(e){const s=o("question-card"),t=o("forfeit-card"),r=o("timer-zone");K(),e.type==="forfeit"?(s.classList.add("hidden"),t.classList.remove("hidden"),t.innerHTML=`<span class="forfeit-title">${e.performer}'s Forfeit</span><span class="forfeit-text">${e.text}</span>`,r.classList.remove("hidden")):(t.classList.add("hidden"),r.classList.add("hidden"),s.classList.remove("hidden"),s.textContent=e.text)}function C(e){o("turn-indicator").textContent=e}function $(e){o("host-controls").classList.toggle("hidden",!e)}function k(e,s){var y;if(!n.isRemote)return;const t=n.isHost?0:1,r=e===t,i=((y=s==null?void 0:s[e])==null?void 0:y.name)||"Partner",a=o("awaiting-turn"),u=document.querySelector(".card-container"),p=o("timer-zone"),l=o("host-controls");r?(a.classList.add("hidden"),u.classList.remove("hidden"),l.classList.remove("hidden")):(a.classList.remove("hidden"),u.classList.add("hidden"),p.classList.add("hidden"),l.classList.add("hidden"),o("awaiting-message").textContent=`It's ${i}'s turn`)}function q(e=!0){m("game"),$(e),n.isRemote&&n.roomCode?(o("remote-badge").classList.remove("hidden"),o("remote-room-label").textContent=n.roomCode):o("remote-badge").classList.add("hidden")}function be(){if(n.currentPlayerIndex=(n.currentPlayerIndex+1)%n.players.length,n.mode==="group"){o("interstitial-message").textContent=`Pass to ${n.players[n.currentPlayerIndex].name}`,m("interstitial");return}const e=I(),s=T();n.mode==="group"&&(n.currentTargetIndex=pickGroupTarget()),v(),n.isRemote&&d&&n.isHost&&d.send({type:"NEXT_QUESTION",card:{type:"question",text:e.text??e},targetIndex:n.currentTargetIndex}),E({type:"question",text:e.text??e}),C(s),k(n.currentPlayerIndex,n.players)}function xe(){const e=I();let s=null;if((e.type==="target"||e.type==="group")&&e.type==="target"){let r;do r=Math.floor(Math.random()*n.players.length);while(r===n.currentPlayerIndex&&n.players.length>1);s=r,n.currentTargetIndex=r}const t=T(s);v(),E({type:"question",text:e.text}),C(t)}function ve(){const e=_e();let s;n.mode==="group"?s=n.currentTargetIndex!==null?n.players[n.currentTargetIndex].name:n.players[n.currentPlayerIndex].name:s=n.players[(n.currentPlayerIndex+1)%2].name;const t={type:"forfeit",text:e.text??e,performer:s};v(),n.isRemote&&d&&n.isHost&&d.send({type:"TAKE_FORFEIT",card:t}),E(t)}function Ee(){if(n.currentPlayerIndex=(n.currentPlayerIndex+1)%n.players.length,n.mode==="group"){o("interstitial-message").textContent=`Pass to ${n.players[n.currentPlayerIndex].name}`,m("interstitial");return}const e=I(),s=T();v(),n.isRemote&&d&&n.isHost&&d.send({type:"SKIP_QUESTION",card:{type:"question",text:e.text??e}}),E({type:"question",text:e.text??e}),C(s),k(n.currentPlayerIndex,n.players)}function Le(){const e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";return Array.from({length:6},()=>e[Math.floor(Math.random()*e.length)]).join("")}o("btn-mode-couple").addEventListener("click",()=>{n.mode="couple",o("setup-two-title").textContent="Enter names and select roles!",o("p1-role-row").style.display="",o("p2-role-row").style.display="",document.getElementById("enable-remote").checked=!1,m("setupTwo")});o("btn-mode-friends").addEventListener("click",()=>{n.mode="friends",o("setup-two-title").textContent="Enter player names!",o("p1-role-row").style.display="none",o("p2-role-row").style.display="none",document.getElementById("enable-remote").checked=!1,m("setupTwo")});o("btn-mode-group").addEventListener("click",()=>{n.mode="group",n.players=[],M([]),m("setupGroup")});o("btn-join-room").addEventListener("click",()=>{m("join")});o("btn-join-back").addEventListener("click",()=>m("welcome"));o("join-code-input").addEventListener("input",e=>{e.target.value=e.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,6)});o("btn-join-submit").addEventListener("click",async()=>{const e=o("join-code-input").value.trim(),s=o("join-name-input").value.trim()||"Guest";if(e.length<4){alert("Please enter a valid room code.");return}n.roomCode=e,n.isRemote=!0,n.isHost=!1,d=new z(e,s),d.on("STATE_SYNC",t=>{if(t.phase==="lobby"){const r=t.pendingPlayers||[];o("guest-players-list").innerHTML=r.map(i=>`<span class="room-player-chip ${i.isHost?"is-host":""}">
          ${i.isHost?"ðŸ‘‘":"ðŸ‘¤"} ${i.name}
        </span>`).join(""),o("guest-lobby-status").textContent=r.length?`${r.length} player${r.length!==1?"s":""} in the room â€” waiting for host to start...`:"Connecting..."}else if(t.phase==="game"&&(n.mode=t.mode,n.players=t.players,n.intensity=t.intensity,N.game.classList.contains("active")||q(!1),k(t.currentPlayerIndex,t.players),t.currentCard)){const r=n.isHost?0:1;t.currentPlayerIndex===r&&(E(t.currentCard),C(Ce(t)))}}),d.on("HOST_CHANGED",()=>{n.isHost=!0,$(!0)}),await d.connect(),d.send({type:"PLAYER_JOIN",name:s}),o("join-code-input").value="",m("guestLobby")});function Ce(e){var r,i;if(!((r=e.players)!=null&&r.length))return"";const s=e.players[e.currentPlayerIndex];if(!s)return"";if(e.mode==="group"){const a=e.currentTargetIndex;return a!=null?`${s.name} asks ${(i=e.players[a])==null?void 0:i.name}:`:`${s.name} asks the group:`}const t=e.players[(e.currentPlayerIndex+1)%2];return t?`${s.name} asks ${t.name}:`:""}o("btn-back-two").addEventListener("click",()=>m("welcome"));o("btn-start-two").addEventListener("click",()=>{var i;const e=o("p1-name").value.trim()||"Player 1",s=o("p2-name").value.trim()||"Player 2",t=((i=document.querySelector('input[name="intensity"]:checked'))==null?void 0:i.value)||"spicy",r=document.getElementById("enable-remote").checked;n.mode==="couple"?n.players=[{name:e,role:o("p1-role").value,isHost:!0},{name:s,role:o("p2-role").value}]:n.players=[{name:e,isHost:!0},{name:s}],n.intensity=t,n.currentPlayerIndex=0,n.usedQuestions=[],n.usedForfeits=[],n.currentTargetIndex=null,r?Ie():(n.isRemote=!1,n.isHost=!0,v(),X())});let g=[];function M(e){g=e;const s=o("player-list");s.innerHTML=e.map((t,r)=>`
    <li>
      <span>${t.name}</span>
      <button class="remove-player-btn" data-idx="${r}" aria-label="Remove ${t.name}">Ã—</button>
    </li>
  `).join(""),s.querySelectorAll(".remove-player-btn").forEach(t=>{t.addEventListener("click",()=>{g.splice(Number(t.dataset.idx),1),M(g)})})}function Z(){const e=o("new-player-name"),s=e.value.trim();if(s){if(g.some(t=>t.name===s)){alert("Name already in the list.");return}g.push({name:s,isHost:g.length===0}),M(g),e.value="",e.focus()}}o("btn-add-player").addEventListener("click",Z);o("new-player-name").addEventListener("keypress",e=>{e.key==="Enter"&&Z()});o("btn-back-group").addEventListener("click",()=>m("welcome"));o("btn-start-group").addEventListener("click",()=>{var s;if(g.length<2){alert("You need at least 2 players to start.");return}const e=((s=document.querySelector('input[name="group-intensity"]:checked'))==null?void 0:s.value)||"spicy";n.players=[...g],n.intensity=e,n.currentPlayerIndex=0,n.usedQuestions=[],n.usedForfeits=[],n.currentTargetIndex=null,n.isRemote=!1,n.isHost=!0,v(),o("interstitial-message").textContent=`Pass to ${n.players[0].name}`,o("interstitial-sub")&&(o("interstitial-sub").textContent="You're asking the first question!"),m("interstitial")});o("btn-ready").addEventListener("click",()=>{q(!0),xe()});async function Ie(){n.roomCode=Le(),n.isRemote=!0,n.isHost=!0;const e=`${location.origin}?room=${n.roomCode}`;o("room-code-display").textContent=n.roomCode,o("share-link").value=e,m("roomLobby"),R([{name:n.players[0].name,isHost:!0}]),d=new z(n.roomCode,n.players[0].name),d.on("STATE_SYNC",s=>{if(s.phase==="game"){k(s.currentPlayerIndex,n.players);return}const t=s.pendingPlayers||[];t.length?R(t):R([{name:n.players[0].name,isHost:!0}]);const r=t.length;o("btn-start-remote").disabled=r<2,o("btn-start-remote").textContent=r>=2?`Start Game (${r} players) ðŸŽ®`:`Waiting for players... (${r} in room)`}),await d.connect(),d.send({type:"HOST_INIT",name:n.players[0].name,role:n.players[0].role||null})}function R(e){o("room-players-list").innerHTML=e.map(s=>`<span class="room-player-chip ${s.isHost?"is-host":""}">
      ${s.isHost?"ðŸ‘‘":"ðŸ‘¤"} ${s.name}
    </span>`).join("")}o("btn-copy-link").addEventListener("click",()=>{const e=o("share-link").value;navigator.clipboard.writeText(e).then(()=>{o("btn-copy-link").textContent="âœ…",setTimeout(()=>{o("btn-copy-link").textContent="ðŸ“‹"},2e3)})});o("btn-cancel-room").addEventListener("click",()=>{d&&(d.disconnect(),d=null),n.isRemote=!1,n.roomCode=null,m("setupTwo")});o("btn-start-remote").addEventListener("click",()=>{d&&(d.send({type:"GAME_CONFIG",mode:n.mode,players:n.players,intensity:n.intensity}),X())});function X(){q(!0);const e=I();let s=null;if(n.mode==="group"){let r;do r=Math.floor(Math.random()*n.players.length);while(r===n.currentPlayerIndex&&n.players.length>1);s=r,n.currentTargetIndex=r}const t=T(s);E({type:"question",text:e.text??e}),C(t),k(n.currentPlayerIndex,n.players),v()}o("btn-next").addEventListener("click",()=>{n.mode==="group"?(n.currentPlayerIndex=(n.currentPlayerIndex+1)%n.players.length,o("interstitial-message").textContent=`Pass to ${n.players[n.currentPlayerIndex].name}`,m("interstitial")):be()});o("btn-forfeit").addEventListener("click",ve);o("btn-skip").addEventListener("click",Ee);o("btn-timer").addEventListener("click",we);o("btn-home").addEventListener("click",()=>{window.confirm("End this game and return to the main menu?")&&Te()});function Te(){ge(),d&&(d.disconnect(),d=null),Object.assign(n,{mode:null,players:[],currentPlayerIndex:0,currentTargetIndex:null,usedQuestions:[],usedForfeits:[],isRemote:!1,isHost:!1,roomCode:null}),K(),o("question-card").textContent="Tap 'Next Question' to begin!",o("question-card").classList.remove("hidden"),o("forfeit-card").classList.add("hidden"),o("timer-zone").classList.add("hidden"),m("welcome")}function ke(){const s=new URLSearchParams(location.search).get("room");s&&(o("join-code-input").value=s.toUpperCase(),m("join"))}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});(async()=>{await fe(),ke();const e=new URLSearchParams(location.search);if(!e.get("room")&&ye()){m("game"),$(!0);const s=I();let t=null;if(n.mode==="group"){let r;do r=Math.floor(Math.random()*n.players.length);while(r===n.currentPlayerIndex&&n.players.length>1);t=r,n.currentTargetIndex=r}E({type:"question",text:s.text??s}),C(T(t))}else e.get("room")||m("welcome")})();
